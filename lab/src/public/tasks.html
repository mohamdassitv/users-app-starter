<!-- Copied tasks page (was index.html) -->
<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Ops 101 Lab – Tasks</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="/styles.css">
</head>
<body>
<style>#syncIndicator{position:fixed;bottom:10px;right:14px;background:#132033;color:#cbd5e1;font-size:11px;padding:6px 10px;border-radius:10px;border:1px solid #1f2d3d;z-index:5000;font-family:ui-monospace,monospace;box-shadow:0 4px 12px -4px rgba(0,0,0,.4);}</style>

  <header class="site-header" id="siteHeader">
    <div class="brand" style="display:flex;align-items:center;gap:10px;cursor:pointer;" id="brandNav">
  <img src="/logo.svg" alt="logo" class="logo-img" />
      <span class="brand-hacker" title="Return to hub">CHECK POINT</span>
    </div>
  </header>
  <main class="page fade-in">
    <div class="hero-wrapper" id="hero" style="padding:60px 40px 40px;">
      <h1 class="hero-title" id="heroTitle" aria-label="Tasks">Tasks<span class="hero-caret" aria-hidden="true"></span></h1>
      <p class="hero-sub" id="candidateGreeting" style="margin-top:6px;">Loading session…</p>
      <div style="margin-top:12px;font-size:13px;color:#d0d6e0;" id="switchCandidateWrap"></div>
    </div>
    <section class="section hero-grid"></section>
    <section class="section">
      <div class="task-list" role="list" aria-label="Assessment tasks">
        <div style="background:#132033;border:1px solid #1f2d3d;padding:18px 20px;border-radius:18px;margin:0 0 26px;">
          <h2 style="margin:0 0 8px;font-size:17px;">Exam Template</h2>
          <p style="margin:0 0 10px;font-size:13px;color:#cbd5e1;line-height:1.5;" id="templateNotice">Loading template info…</p>
          <button id="btnDownloadTemplate" class="btn" style="background:linear-gradient(135deg,#0ea5e9,#0284c7);color:#fff;font-weight:600;display:none;">Download Exam DOCX</button>
        </div>
        <div class="task-row" role="listitem">
          <div class="task-badge">Case Study</div>
          <h3>Task 1 — Branch Performance Degradation</h3>
          <div class="actions"><a class="btn" href="/task/casestudy.html">Open →</a></div>
        </div>
        <div class="task-row" role="listitem">
          <div class="task-badge">Communication</div>
          <h3>Task 2 — Customer Escalation Email</h3>
          <div class="actions"><a class="btn" href="/task/mail.html">Open →</a></div>
        </div>
        <div class="task-row" role="listitem">
          <div class="task-badge">Reliability</div>
          <h3>Task 3 — Shift Alert Correlation & Handover</h3>
          <div class="actions"><a class="btn" href="/task/alerts.html">Open →</a></div>
        </div>
        <div class="task-row" role="listitem">
          <div class="task-badge">Operations</div>
          <h3>Task 4 — High-Volume User Cleanup</h3>
          <div class="actions"><a class="btn" href="/task/users.html">Open →</a></div>
        </div>
        <div class="task-row" role="listitem">
          <div class="task-badge">Networking</div>
          <h3>Task 5 — Configure Basic Routing</h3>
          <div class="actions"><a class="btn" href="/task/routing-task5.html">Open →</a></div>
        </div>
        <div class="task-row" role="listitem">
          <div class="task-badge">Analysis</div>
          <h3>Task 6 — Tenant Data Investigation</h3>
          <div class="actions"><a class="btn" href="/task/tenants.html">Open →</a></div>
        </div>
      </div>
    </section>
  </main>
  <div style="max-width:980px;margin:30px auto 80px;padding:0 40px;">
    <div id="finalSubmitBox" style="background:#132033;border:1px solid #1f2d3d;padding:20px 24px;border-radius:18px;">
      <h2 style="margin:0 0 8px;font-size:18px;">Final Submission</h2>
      <p style="margin:0 0 14px;font-size:13px;color:#cbd5e1;">Upload your final PDF (required) and optional DOCX. Uploading locks your exam and redirects you to the finish page.</p>
      <h3 style="margin:0 0 10px;font-size:16px;">Upload Final Work</h3>
      <p style="margin:0 0 10px;font-size:12px;color:#94a3b8;">Ensure all answers from the exam template are included before uploading. This action is irreversible.</p>
      <form id="finalUploadForm" enctype="multipart/form-data" style="display:flex;flex-direction:column;gap:12px;">
        <div style="display:flex;flex-wrap:wrap;gap:18px;align-items:flex-end;">
          <label style="font-size:12px;color:#cbd5e1;">PDF File (required)<br>
            <input type="file" id="pdfFile" name="pdfFile" accept="application/pdf" required style="margin-top:4px;" />
          </label>
          <label style="font-size:12px;color:#cbd5e1;">DOCX File (optional)<br>
            <input type="file" id="docxFile" name="docxFile" accept="application/vnd.openxmlformats-officedocument.wordprocessingml.document,.docx" style="margin-top:4px;" />
          </label>
          <button type="submit" id="btnUploadFinal" class="btn" style="background:linear-gradient(135deg,#0ea5e9,#0284c7);color:#fff;font-weight:600;">Upload & Lock</button>
        </div>
        <div id="uploadMsg" style="font-size:12px;color:#cbd5e1;"></div>
      </form>
    </div>
  </div>
  <a href="/contact.html" class="help-fab" id="helpFab" title="Questions? Reach the on-call engineer.">
  <img src="/help-contact.svg" alt="Contact" width="38" height="38">
  <span class="help-label">Questions? Contact on-call.</span>
  </a>
  <script>
    (function(){
      const header=document.getElementById('siteHeader');
      const brand=document.getElementById('brandNav');
      if(brand){
        brand.addEventListener('click',()=>{
          const slug=localStorage.getItem('candidateSlug');
          const hub=localStorage.getItem('candidateHubToken');
          if(slug && hub){ window.location='/c/'+slug+'/'+hub; }
          else { window.location='tasks.html'; }
        });
      }
      window.addEventListener('scroll',()=>{const y=window.scrollY;header.classList.toggle('shrink', y>16);});
      const email=localStorage.getItem('candidateEmail');
      const name=localStorage.getItem('candidateName');
      const greet=document.getElementById('candidateGreeting');
      const wrap=document.getElementById('switchCandidateWrap');
      if(email){
        if(greet) greet.textContent=(name? name+' – ':'')+'Select a task to begin or continue.';
        if(wrap){wrap.innerHTML='Logged in as <strong>'+(name||email)+'</strong>. <a href="#" id="switchCandidateLink">Switch candidate</a>';wrap.querySelector('#switchCandidateLink').addEventListener('click',ev=>{ev.preventDefault();if(confirm('Switch candidate? Timer persists.')){localStorage.removeItem('candidateEmail');localStorage.removeItem('candidateName');document.cookie='cand=; Max-Age=0; path=/';location.href='/login.html';}});} }
      else { if(greet) greet.textContent='Not logged in'; if(wrap) wrap.innerHTML='No session. <a href="/login.html">Login</a>'; }

      // Final submission logic
      const box=document.getElementById('finalSubmitBox');
      const uploadForm=document.getElementById('finalUploadForm');
      const uploadBtn=document.getElementById('btnUploadFinal');
      const uploadMsg=document.getElementById('uploadMsg');
      if(email && localStorage.getItem('candidateSubmitted')==='1'){
        box.style.opacity='0.75';
        uploadMsg.textContent='Already submitted. Redirecting…';
        setTimeout(()=>{ location.href='/finished.html'; },1200);
        if(uploadBtn) uploadBtn.disabled=true;
        if(uploadForm) uploadForm.querySelectorAll('input,button').forEach(el=> el.disabled=true);
      }
      // File upload submission
      if(uploadForm && email){
        uploadForm.addEventListener('submit', async (e)=>{
          e.preventDefault();
          if(localStorage.getItem('candidateSubmitted')==='1'){ alert('Already submitted.'); return; }
          const pdfInput=document.getElementById('pdfFile');
          if(!pdfInput.files.length){ alert('PDF file required'); return; }
          const pdfFile=pdfInput.files[0];
          if(pdfFile.size > 15*1024*1024){ alert('PDF exceeds 15MB limit'); return; }
          const docxInput=document.getElementById('docxFile');
          if(docxInput.files[0] && docxInput.files[0].size > 15*1024*1024){ alert('DOCX exceeds 15MB limit'); return; }
          if(!confirm('Upload now and lock your exam? This cannot be undone.')) return;
          uploadBtn.disabled=true; uploadBtn.textContent='Uploading...';
          uploadMsg.textContent='Uploading files...';
          try {
            const fd=new FormData();
            fd.append('email', email);
            fd.append('pdfFile', pdfFile);
            if(docxInput.files[0]) fd.append('docxFile', docxInput.files[0]);
            const r=await fetch('/api/candidate/upload-final',{method:'POST',body:fd});
            if(!r.ok){
              uploadBtn.disabled=false; uploadBtn.textContent='Upload & Lock';
              uploadMsg.textContent='Upload failed ('+r.status+').';
              return;
            }
            const j=await r.json();
            localStorage.setItem('candidateSubmitted','1');
            uploadMsg.textContent='Files uploaded and exam locked at '+ (j.uploadedAt? new Date(j.uploadedAt).toLocaleString(): new Date().toLocaleString()) +'. Redirecting...';
            uploadMsg.textContent+=' Redirecting...';
            uploadBtn.textContent='Uploaded';
            box.style.opacity='0.75';
            uploadForm.querySelectorAll('input,button').forEach(el=> el.disabled=true);
            setTimeout(()=>{ location.href='/finished.html'; },1500);
          } catch(err){
            uploadBtn.disabled=false; uploadBtn.textContent='Upload & Lock';
            uploadMsg.textContent='Network error uploading';
          }
        });
      }

      // Exam template fetch
      const templateNotice=document.getElementById('templateNotice');
      const dlBtn=document.getElementById('btnDownloadTemplate');
      fetch('/exam-template/meta').then(r=> r.json()).then(j=>{
        if(!j.available){ templateNotice.textContent='Exam template not yet published. Check back soon.'; return; }
        templateNotice.innerHTML='Download the DOCX template below. Complete ALL tasks inside that file. When finished, upload your final PDF (and optional DOCX) in the Finalize section below.';
        dlBtn.style.display='inline-block';
        dlBtn.addEventListener('click',()=>{ window.open('/exam-template/download','_blank'); });
      }).catch(()=>{ templateNotice.textContent='Unable to load template status.'; });
      
      // ---------- Session bootstrap for persistent autosave (candidate side) ----------
      try {
        const email = localStorage.getItem('candidateEmail');
        const name = localStorage.getItem('candidateName');
        let sessionId = localStorage.getItem('examSessionId');
        async function createIfNeeded(){
          if(!email) return; if(sessionId) return;
          const r=await fetch('/api/sessions',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({candidate_name:name,email})});
          if(r.ok){ const j=await r.json(); sessionId=j.session.id; localStorage.setItem('examSessionId',sessionId); }
        }
        createIfNeeded();
      }catch(e){ /* ignore */ }
    })();
  </script>
  <script src="/answer-sync.js" defer></script>
  <script src="/header-timer.js" defer></script>
</body></html>