<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Task 2 ‚Äî Customer Escalation Email Response</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="stylesheet" href="/styles.css" />
<style>
/* Modern Email Client UI - Bold/Clean Style */
* { box-sizing: border-box; margin: 0; padding: 0; }
body { 
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  background: #f9fafb;
  color: #1f2937;
  line-height: 1.5;
}

.email-app-container {
  display: flex;
  height: calc(100vh - 200px);
  background: #e5e7eb;
  box-shadow: 0 0 0 1px rgba(0,0,0,0.06);
}

/* Sidebar */
.email-sidebar {
  width: 260px;
  background: linear-gradient(180deg, #374151 0%, #1f2937 100%);
  border-right: 1px solid #6b7280;
  display: flex;
  flex-direction: column;
  overflow-y: auto;
}

.compose-btn {
  margin: 20px 16px 24px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  border: none;
  padding: 14px 20px;
  border-radius: 8px;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.2s;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
}
.compose-btn:hover { background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%); transform: translateY(-1px); box-shadow: 0 6px 16px rgba(102, 126, 234, 0.5); }
.compose-btn:before { content: "‚úè"; font-size: 16px; }

.folder-list {
  padding: 0;
  border-top: 1px solid #6b7280;
}
.folder-item {
  padding: 14px 20px;
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
  font-size: 14px;
  color: #e5e7eb;
  transition: all 0.15s;
  border-bottom: 1px solid #6b7280;
  margin: 0;
}
.folder-item:hover { background: rgba(102, 126, 234, 0.2); }
.folder-item.active { background: linear-gradient(90deg, rgba(75, 85, 99, 0.5) 0%, rgba(55, 65, 81, 0.5) 100%); color: #fff; font-weight: 600; border-left: 2px solid #9ca3af; }
.folder-icon { width: 20px; text-align: center; }
.folder-count { margin-left: auto; color: #d1d5db; font-size: 13px; }

/* Main email area */
.email-main {
  flex: 1;
  display: flex;
  flex-direction: row;
  overflow: hidden;
}

/* Email list pane */
.email-list-pane {
  width: 420px;
  border-right: 2px solid #d1d5db;
  display: flex;
  flex-direction: column;
  background: #f3f4f6;
  flex-shrink: 0;
}

.list-header {
  padding: 20px 20px;
  border-bottom: 1px solid #cbd5e1;
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: linear-gradient(135deg, #d1d5db 0%, #9ca3af 100%);
}
.list-header h2 { font-size: 20px; font-weight: 700; color: #111827; }
.list-tools { display: flex; gap: 8px; }
.tool-btn {
  background: transparent;
  border: 1px solid #d1d5db;
  padding: 6px 10px;
  border-radius: 6px;
  font-size: 12px;
  color: #6b7280;
  cursor: pointer;
  transition: all 0.15s;
}
.tool-btn:hover { background: #f9fafb; border-color: #9ca3af; color: #374151; }

.search-box {
  padding: 16px 16px;
  border-bottom: 1px solid #cbd5e1;
  background: linear-gradient(135deg, #d1d5db 0%, #9ca3af 100%);
}
.search-input {
  width: 100%;
  padding: 8px 12px 8px 36px;
  border: 1px solid #cbd5e1;
  border-radius: 6px;
  font-size: 13px;
  background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="%23666" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>') no-repeat 10px center;
  background-size: 16px;
}
.search-input:focus { outline: none; border-color: #9ca3af; box-shadow: 0 0 0 3px rgba(156, 163, 175, 0.1); }

.email-list {
  flex: 1;
  overflow-y: auto;
}

.email-item {
  padding: 18px 16px;
  border-bottom: 1px solid #e5e7eb;
  cursor: pointer;
  transition: all 0.15s;
  position: relative;
  margin: 0;
  text-align: left;
}
.email-item:hover { background: #e5e7eb; }
.email-item.active { background: linear-gradient(90deg, #e5e7eb 0%, #f3f4f6 100%); border-left: 3px solid #667eea; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); }
.email-item.unread { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); }
.email-item.unread .email-subject { font-weight: 700; }

.email-item-header {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  margin-bottom: 4px;
  text-align: left;
}
  align-items: baseline;
  margin-bottom: 4px;
}
.email-sender {
  font-weight: 600;
  font-size: 14px;
  color: #111827;
  text-align: left;
}
.email-item.unread .email-sender { font-weight: 700; }
.email-time {
  font-size: 12px;
  color: #6b7280;
  text-align: right;
}
.email-subject {
  font-size: 13px;
  color: #374151;
  margin-bottom: 4px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  text-align: left;
}
.email-preview {
  font-size: 12px;
  color: #6b7280;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  text-align: left;
}

.label-badge {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 4px;
  font-size: 10px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-top: 8px;
  margin-right: 6px;
  border: 1px solid currentColor;
}
.label-urgent { background: #fee2e2; color: #991b1b; }
.label-external { background: #fef3c7; color: #92400e; }
.label-support { background: #dbeafe; color: #1e40af; }

/* Email detail pane */
.email-detail-pane {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  background: #e5e7eb;
}

.detail-header {
  padding: 24px 32px;
  border-bottom: 1px solid #cbd5e1;
  background: linear-gradient(135deg, #d1d5db 0%, #9ca3af 100%);
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
}
.detail-actions {
  display: flex;
  gap: 12px;
  margin-bottom: 20px;
}
.action-btn {
  background: #d1d5db;
  border: 1px solid #9ca3af;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 500;
  color: #1f2937;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: all 0.15s;
}
.action-btn:hover { background: #e5e7eb; border-color: #6b7280; }
.action-btn.primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; border-color: transparent; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); }
.action-btn.primary:hover { background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%); transform: translateY(-1px); box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4); }

.email-subject-line {
  font-size: 24px;
  font-weight: 700;
  color: #111827;
  margin-bottom: 4px;
}

.detail-labels {
  display: flex;
  gap: 6px;
  margin-top: 8px;
}

.detail-body {
  flex: 1;
  overflow-y: auto;
  padding: 0;
}

.message-card {
  background: #f9fafb;
  border-bottom: 1px solid #e5e7eb;
  padding: 28px 32px;
  margin-bottom: 2px;
}

.message-header {
  display: flex;
  gap: 16px;
  margin-bottom: 20px;
  align-items: flex-start;
}
.sender-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  color: #fff;
  font-weight: 700;
  font-size: 16px;
  flex-shrink: 0;
}
.message-meta {
  flex: 1;
}
.message-from {
  font-weight: 700;
  font-size: 15px;
  color: #111827;
  margin-bottom: 2px;
}
.message-to {
  font-size: 13px;
  color: #6b7280;
}
.message-to strong { color: #374151; font-weight: 600; }
.message-timestamp {
  font-size: 13px;
  color: #6b7280;
  text-align: right;
}

.message-content {
  font-size: 14px;
  line-height: 1.7;
  color: #374151;
  padding-left: 56px;
}
.message-content p {
  margin: 0 0 12px;
}
.message-content p:last-child { margin-bottom: 0; }

.message-warning {
  background: #fffbeb;
  border: 2px solid #fbbf24;
  border-left: 5px solid #f59e0b;
  padding: 14px 18px;
  border-radius: 6px;
  margin: 20px 56px;
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 13px;
  color: #92400e;
  box-shadow: 0 2px 6px rgba(245,158,11,0.15);
}
.message-warning:before {
  content: "‚ö†";
  font-size: 18px;
  color: #f59e0b;
}

.message-attachment {
  background: #f9fafb;
  border: 1px solid #e5e7eb;
  padding: 12px 16px;
  border-radius: 6px;
  margin: 16px 56px 0;
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 13px;
}
.attachment-icon {
  width: 32px;
  height: 32px;
  background: #dbeafe;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
}
.attachment-info {
  flex: 1;
}
.attachment-name {
  font-weight: 600;
  color: #111827;
}
.attachment-flagged {
  color: #dc2626;
  font-weight: 600;
  font-size: 12px;
}

/* Response area */
.response-area {
  background: linear-gradient(135deg, #d1d5db 0%, #9ca3af 100%);
  border-top: 1px solid #cbd5e1;
  padding: 28px 32px;
  box-shadow: 0 -2px 8px rgba(102, 126, 234, 0.1);
}
.response-label {
  font-size: 13px;
  font-weight: 700;
  color: #374151;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.response-label:before {
  content: "üìù";
  font-size: 16px;
}

.task-instructions {
  background: #ecfdf5;
  border: 2px solid #6ee7b7;
  border-left: 5px solid #10b981;
  padding: 20px 24px;
  border-radius: 8px;
  margin-bottom: 24px;
  font-size: 13px;
  line-height: 1.6;
  color: #065f46;
  box-shadow: 0 2px 8px rgba(16,185,129,0.1);
}
.task-instructions strong {
  color: #047857;
  display: block;
  margin-bottom: 8px;
  font-size: 14px;
}

.header-toggle-bar {
  display: flex;
  gap: 12px;
  margin: 20px 0;
  padding: 16px 56px;
  background: linear-gradient(135deg, #d1d5db 0%, #9ca3af 100%);
  border-radius: 0;
  border-top: 1px solid #cbd5e1;
  border-bottom: 1px solid #cbd5e1;
}
.toggle-btn {
  background: #d1d5db;
  border: 1px solid #9ca3af;
  padding: 6px 14px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 500;
  color: #1f2937;
  cursor: pointer;
  transition: all 0.15s;
}
.toggle-btn:hover { background: #e5e7eb; color: #111827; border-color: #9ca3af; }
.toggle-btn.active {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  border-color: transparent;
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.headers-view {
  background: #1e293b;
  color: #e2e8f0;
  font-family: 'Courier New', monospace;
  font-size: 12px;
  padding: 16px;
  border-radius: 6px;
  margin: 16px 56px;
  max-height: 300px;
  overflow: auto;
  white-space: pre-wrap;
  line-height: 1.6;
}

/* CKEditor styling */
.ck-editor__editable { min-height: 200px !important; }

/* Responsive */
@media (max-width: 1024px) {
  .email-sidebar { width: 200px; }
  .email-list-pane { width: 320px; }
}
@media (max-width: 768px) {
  .email-sidebar { display: none; }
  .email-list-pane { width: 100%; border-right: none; }
  .email-detail-pane { display: none; }
  .email-item.active ~ .email-detail-pane { display: flex; position: fixed; inset: 60px 0 0 0; z-index: 100; }
}
</style>
</head>
<body>
<header class="site-header" id="siteHeader">
  <div class="brand" style="display:flex;align-items:center;gap:10px;cursor:pointer;" onclick="location.href='/tasks.html'">
    <img src="/logo.svg" alt="Logo" class="logo-img">
    <span class="brand-hacker">CHECK POINT</span>
  </div>  <a href="/tasks.html" style="display:flex;align-items:center;gap:6px;padding:8px 16px;background:rgba(6,78,59,0.9);color:#fff;text-decoration:none;border-radius:8px;font-size:14px;font-weight:600;border:1px solid #86efac;transition:all 0.3s;" onmouseover="this.style.background='#047857'" onmouseout="this.style.background='rgba(6,78,59,0.9)'">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
    Main Tasks
  </a></header>

<!-- Progress bar -->
<div style="max-width:1400px;margin:20px auto;padding:0 40px;">
  <div style="background:#f1f5f9;border:1px solid #cbd5e1;border-radius:12px;padding:16px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
      <span style="font-size:13px;font-weight:600;color:#0f172a;">Progress</span>
      <span id="progressText" style="font-size:12px;color:#64748b;">0/2 Questions Saved</span>
    </div>
    <div style="background:#e2e8f0;border-radius:8px;height:12px;overflow:hidden;">
      <div id="progressBar" style="background:linear-gradient(90deg,#10b981,#059669);height:100%;width:0%;transition:width 0.5s ease;"></div>
    </div>
  </div>
</div>

<div class="email-app-container" style="height: auto; min-height: calc(100vh - 100px); margin-top: 0; display: flex; background: #fff;">
  
  <!-- Main Content Area -->
  <div class="email-main" style="flex: 1; display: flex;">
    
    <!-- Email List Pane -->
    <div class="email-list-pane">
      <div class="list-header">
        <h2>Inbox</h2>
        <div class="list-tools">
          <button class="tool-btn" style="pointer-events: none;">üîÑ</button>
        </div>
      </div>
      
      <div class="email-list">
        <!-- Email 1 Item -->
        <div class="email-item active unread" data-email="email-1">
          <div class="email-item-header">
            <span class="email-sender">Othman Kharoubi</span>
            <span class="email-time">8:34 AM</span>
          </div>
          <div class="email-subject">Harmony Connect NOT WORKING - PLEASE HELP HERE !!!!!!!!!!!</div>
          <div class="email-preview">We opened a Service Request 847291 7 days ago. Since then ‚Äì no response!!!!</div>
          <div>
            <span class="label-badge label-urgent">URGENT</span>
            <span class="label-badge label-support">SR 847291</span>
          </div>
        </div>
        
        <!-- Email 2 Item -->
        <div class="email-item unread" data-email="email-2">
          <div class="email-item-header">
            <span class="email-sender">Othman Kharoubi</span>
            <span class="email-time">2:17 PM</span>
          </div>
          <div class="email-subject">FW: Urgent VPN Token Validation Required</div>
          <div class="email-preview">We just received this from "Check Point Validation." Can you please confirm...</div>
          <div>
            <span class="label-badge label-external">EXTERNAL</span>
            <span class="label-badge label-urgent">SUSPICIOUS</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Email Detail Pane -->
    <div class="email-detail-pane" style="flex: 1; overflow-y: auto; background: #f9fafb; display: flex; flex-direction: column;">
      
      <!-- Email 1 Detail -->
      <div id="email-1" style="display: block; padding: 32px; max-width: 100%; margin: 0 auto;">
        <div style="background: #fff; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); overflow: hidden; border: 1px solid #e5e7eb;">
          
          <!-- Email header -->
          <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; padding: 28px 32px; border-bottom: 3px solid #5a67d8;">
            <div style="display: flex; align-items: start; gap: 16px; margin-bottom: 16px;">
              <div style="width: 54px; height: 54px; border-radius: 50%; background: #fff; display: flex; align-items: center; justify-content: center; color: #667eea; font-weight: 800; font-size: 22px; flex-shrink: 0; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">OK</div>
              <div style="flex: 1;">
                <h2 style="font-size: 26px; font-weight: 800; color: #fff; margin: 0 0 10px 0; line-height: 1.3;">Harmony Connect NOT WORKING - PLEASE HELP HERE !!!!!!!!!!!</h2>
                <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                  <span style="background: #ef4444; color: #fff; padding: 4px 12px; border-radius: 6px; font-size: 12px; font-weight: 700;">URGENT</span>
                  <span style="background: #fff; color: #667eea; padding: 4px 12px; border-radius: 6px; font-size: 12px; font-weight: 700;">SR 847291</span>
                </div>
              </div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; font-size: 14px;">
              <div><strong>From:</strong> Othman Kharoubi (CTO, Mycompany)</div>
              <div><strong>To:</strong> support@support.support</div>
              <div><strong>Time:</strong> Today 8:34 AM</div>
              <div><strong>Ticket:</strong> SR 847291</div>
            </div>
          </div>

          <!-- Email body -->
          <div style="padding: 32px;">
            <div style="background: #f9fafb; border-left: 4px solid #667eea; padding: 24px; border-radius: 8px; margin-bottom: 32px;">
              <div style="font-size: 15px; line-height: 1.8; color: #374151;">
                <p style="margin: 0 0 16px 0;">We opened a Service Request 847291 7 days ago. Since then ‚Äì no response!!!!</p>
                <p style="margin: 0 0 16px 0;">The support level we receive for the amount of money we pay is outrageous!</p>
                <p style="margin: 0 0 16px 0;">Our users suffer from frequent connectivity issues!</p>
                <p style="margin: 0 0 16px 0;">Please respond ASAP!!!</p>
                <p style="margin: 24px 0 0 0; color: #6b7280;">B.R.<br>Othman Kharoubi<br>CTO - Mycompany</p>
              </div>
            </div>

            <!-- Response area -->
            <div>
              <div style="background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border-left: 4px solid #10b981; padding: 20px 24px; border-radius: 10px; margin-bottom: 24px; box-shadow: 0 2px 8px rgba(16,185,129,0.1);">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                  <span style="font-size: 24px;">‚úçÔ∏è</span>
                  <strong style="font-size: 18px; color: #065f46;">Question 3: Compose Your Response</strong>
                </div>
                <p style="margin: 0; line-height: 1.7; color: #047857;">Write a concise, professional response to the client. Address their concerns about the delayed SR, acknowledge their frustration, and provide clear next steps.</p>
              </div>
              <div style="font-size: 13px; font-weight: 700; color: #6b7280; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;">üìù Your Email Response</div>
              <div id="editor-task21" data-task-id="mail.task21Response" style="min-height: 300px;"></div>
              <div style="text-align: left; margin-top: 16px;">
                <button onclick="saveTask2Progress('q3')" id="saveQ3Btn" style="background:linear-gradient(135deg, #10b981 0%, #059669 100%);color:#fff;border:none;padding:12px 32px;border-radius:12px;font-size:15px;font-weight:700;cursor:pointer;box-shadow:0 4px 12px rgba(16,185,129,0.3);transition:all 0.3s;" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 16px rgba(16,185,129,0.4)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 4px 12px rgba(16,185,129,0.3)'">
                  ‚úì Save Progress
                </button>
                <div id="progressMessageQ3" style="margin-top:10px;font-size:13px;font-weight:600;color:#059669;min-height:20px;"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Email 2 Detail -->
      <div id="email-2" style="display: none; padding: 32px; max-width: 100%; margin: 0 auto;">
        <div style="background: #fff; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); overflow: hidden; border: 1px solid #e5e7eb;">
          
          <!-- Email header -->
          <div style="background: linear-gradient(135deg, #0ea5e9 0%, #0066ff 100%); color: #fff; padding: 28px 32px; border-bottom: 3px solid #0284c7;">
            <div style="display: flex; align-items: start; gap: 16px; margin-bottom: 16px;">
              <div style="width: 54px; height: 54px; border-radius: 50%; background: #fff; display: flex; align-items: center; justify-content: center; color: #0ea5e9; font-weight: 800; font-size: 22px; flex-shrink: 0; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">OK</div>
              <div style="flex: 1;">
                <h2 style="font-size: 26px; font-weight: 800; color: #fff; margin: 0 0 10px 0; line-height: 1.3;">FW: Urgent VPN Token Validation Required</h2>
                <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                  <span style="background: #ef4444; color: #fff; padding: 4px 12px; border-radius: 6px; font-size: 12px; font-weight: 700;">‚ö† SUSPICIOUS</span>
                  <span style="background: #fff; color: #0ea5e9; padding: 4px 12px; border-radius: 6px; font-size: 12px; font-weight: 700;">EXTERNAL</span>
                </div>
              </div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; font-size: 14px;">
              <div><strong>From:</strong> Othman Kharoubi (CTO, Japan Bank)</div>
              <div><strong>To:</strong> Support Team</div>
              <div><strong>Time:</strong> Today 2:17 PM</div>
            </div>
          </div>

          <!-- Email body -->
          <div style="padding: 32px;">
            <!-- Customer's question -->
            <div style="background: #f0f9ff; border-left: 4px solid #0ea5e9; padding: 24px; border-radius: 8px; margin-bottom: 24px;">
              <div style="font-size: 15px; line-height: 1.8; color: #374151;">
                <p style="margin: 0;">We just received this from "Check Point Validation." Can you please confirm whether it's legit? If it is, we'll follow the steps. If not, tell us what to do next. Forwarding the mail now.</p>
              </div>
            </div>

            <!-- Forwarded suspicious email -->
            <div style="background: #fef2f2; border: 2px solid #ef4444; border-radius: 10px; padding: 24px; margin-bottom: 32px;">
              <div style="background: #fee2e2; color: #991b1b; padding: 12px 16px; border-radius: 6px; margin-bottom: 20px; font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                <span style="font-size: 18px;">‚ö†Ô∏è</span>
                <span>External sender ‚Äî exercise caution with links and attachments</span>
              </div>
              
              <div style="display: flex; gap: 8px; margin-bottom: 20px;">
                <button type="button" class="toggle-btn active" data-view="plain" style="padding: 8px 16px; border: 1px solid #e5e7eb; background: #fff; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.2s;">üìÑ Plain Text</button>
                <button type="button" class="toggle-btn" data-view="headers" style="padding: 8px 16px; border: 1px solid #e5e7eb; background: #fff; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 600; transition: all 0.2s;">üîç View Headers</button>
              </div>

              <div style="background: #fff; padding: 20px; border-radius: 8px; border: 1px solid #fecaca;">
                <div style="display: flex; gap: 12px; margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid #fecaca;">
                  <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); display: flex; align-items: center; justify-content: center; color: #fff; font-weight: 700; font-size: 18px; flex-shrink: 0;">‚ö†</div>
                  <div style="flex: 1; font-size: 13px;">
                    <div style="font-weight: 700; color: #991b1b; margin-bottom: 4px;">"Check Point Validation" &lt;support@checkp0int-security.com&gt;</div>
                    <div style="color: #6b7280;"><strong>To:</strong> you@company.com</div>
                    <div style="color: #6b7280;"><strong>Date:</strong> Mon, 14 Oct 2024 09:12:08 +0000</div>
                    <div style="color: #6b7280;"><strong>Msg-ID:</strong> &lt;98345723.validation@checkp0int-security.com&gt;</div>
                  </div>
                  <div style="text-align: right; font-size: 13px; color: #6b7280;">Oct 14, 9:12 AM</div>
                </div>
                
                <div class="message-content" id="t22Plain" style="font-size: 14px; line-height: 1.8; color: #374151;">
                  <p style="margin: 0 0 12px 0;">Dear User,</p>
                  <p style="margin: 0 0 12px 0;">Our automated security gateway detected an issue validating your Harmony VPN token. To avoid service interruption, you must re-validate within 1 hour.</p>
                  <p style="margin: 0 0 12px 0;"><strong style="color: #dc2626;">Please follow the secure validation portal here:</strong> <span style="font-family: monospace; background: #fee2e2; padding: 2px 6px; border-radius: 4px; color: #991b1b;">hxxps://validate-checkp0int.com/harmony/token?id=98345723</span></p>
                  <p style="margin: 0 0 12px 0;">If you do not act, your remote access will be suspended.</p>
                  <p style="margin: 16px 0 0 0; color: #6b7280;">Regards,<br>Security Validation Robot<br>Check Point Software</p>
                </div>

                <div class="headers-view" id="t22Headers" style="display: none; font-family: monospace; font-size: 12px; background: #1f2937; color: #10b981; padding: 16px; border-radius: 6px; overflow-x: auto; white-space: pre-wrap; line-height: 1.6;">Return-Path: &lt;mailer@validate-checkp0int.com&gt;
From: "Check Point Validation" &lt;support@checkp0int-security.com&gt;
Reply-To: helpdesk@checkp0int-billing.ru
Message-ID: &lt;98345723.validation@checkp0int-security.com&gt;
Received: from 198.51.100.23 (unknown) by mx.customer.example with ESMTP id ABC123
Authentication-Results: mx.customer.example;
  spf=softfail smtp.mailfrom=checkp0int-security.com;
  dkim=none;
  dmarc=fail (p=reject) header.from=checkp0int-security.com
X-Link-Preview: validate-checkp0int.com (not checkpoint.com)</div>

                <div style="background: #fef2f2; border: 1px solid #fecaca; padding: 12px 16px; border-radius: 6px; margin-top: 16px; display: flex; align-items: center; gap: 12px;">
                  <div style="font-size: 24px;">üìé</div>
                  <div style="flex: 1;">
                    <div style="font-weight: 600; color: #374151; font-size: 14px;">Harmony_VPN_Token_Fix.zip</div>
                    <div style="color: #dc2626; font-size: 12px; font-weight: 600; margin-top: 4px;">‚ö† FLAGGED - Attachment stripped by security gateway</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Response area -->
            <div>
              <div style="background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); border-left: 4px solid #10b981; padding: 20px 24px; border-radius: 10px; margin-bottom: 24px; box-shadow: 0 2px 8px rgba(16,185,129,0.1);">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                  <span style="font-size: 24px;">üîç</span>
                  <strong style="font-size: 18px; color: #065f46;">Question 4: Security Analysis & Response</strong>
                </div>
                <p style="margin: 0 0 12px 0; line-height: 1.7; color: #047857;"><strong>Your response should include:</strong></p>
                <ul style="margin: 0; padding-left: 20px; line-height: 1.8; color: #047857;">
                  <li>Your professional assessment (Is this legitimate or phishing?)</li>
                  <li>Key evidence you found (headers, sender details, links, urgency)</li>
                  <li>Potential impact if the customer clicked or responded</li>
                  <li>Actions you're taking to protect them</li>
                  <li>Clear guidance on what they should do next</li>
                </ul>
              </div>
              <div style="font-size: 13px; font-weight: 700; color: #6b7280; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;">üõ°Ô∏è Your Analysis & Reply</div>
              <div id="editor-task22" data-task-id="mail.replyDraft" style="min-height: 350px;"></div>
              <div style="text-align: left; margin-top: 16px;">
                <button onclick="saveTask2Progress('q4')" id="saveQ4Btn" style="background:linear-gradient(135deg, #10b981 0%, #059669 100%);color:#fff;border:none;padding:12px 32px;border-radius:12px;font-size:15px;font-weight:700;cursor:pointer;box-shadow:0 4px 12px rgba(16,185,129,0.3);transition:all 0.3s;" onmouseover="this.style.transform='translateY(-2px)';this.style.boxShadow='0 6px 16px rgba(16,185,129,0.4)'" onmouseout="this.style.transform='translateY(0)';this.style.boxShadow='0 4px 12px rgba(16,185,129,0.3)'">
                  ‚úì Save Progress
                </button>
                <div id="progressMessageQ4" style="margin-top:10px;font-size:13px;font-weight:600;color:#059669;min-height:20px;"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>


<script src="https://cdn.ckeditor.com/ckeditor5/43.3.1/ckeditor5.umd.js"></script>
<link rel="stylesheet" href="https://cdn.ckeditor.com/ckeditor5/43.3.1/ckeditor5.css" />
<script src="/header-timer.js" defer></script>

<script>
// Email list item clicking functionality
document.querySelectorAll('.email-item').forEach(item => {
  item.addEventListener('click', function() {
    const targetEmail = this.dataset.email;
    
    // Update email list items
    document.querySelectorAll('.email-item').forEach(i => {
      i.classList.remove('active');
    });
    this.classList.add('active');
    
    // Update content panels
    document.querySelectorAll('.email-detail-pane > div').forEach(panel => {
      panel.style.display = 'none';
    });
    document.getElementById(targetEmail).style.display = 'block';
  });
});

// Header toggle for email 2
document.querySelectorAll('.toggle-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    const view = this.dataset.view;
    const plain = document.getElementById('t22Plain');
    const headers = document.getElementById('t22Headers');
    
    if (view === 'plain') {
      plain.style.display = 'block';
      headers.style.display = 'none';
      this.style.background = '#667eea';
      this.style.color = '#fff';
      this.style.borderColor = '#667eea';
      document.querySelector('[data-view="headers"]').style.background = '#fff';
      document.querySelector('[data-view="headers"]').style.color = '#374151';
      document.querySelector('[data-view="headers"]').style.borderColor = '#e5e7eb';
    } else {
      plain.style.display = 'none';
      headers.style.display = 'block';
      this.style.background = '#667eea';
      this.style.color = '#fff';
      this.style.borderColor = '#667eea';
      document.querySelector('[data-view="plain"]').style.background = '#fff';
      document.querySelector('[data-view="plain"]').style.color = '#374151';
      document.querySelector('[data-view="plain"]').style.borderColor = '#e5e7eb';
    }
    
    document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
    this.classList.add('active');
  });
});

// Initialize CKEditor for both tasks
(function(){
  const { ClassicEditor, Essentials, Paragraph, Bold, Italic, Underline, Link, List, Image, ImageUpload, Base64UploadAdapter, Heading, BlockQuote, Table, MediaEmbed, Code, CodeBlock } = window.CKEDITOR;

  const editorConfigs = [
    { id: 'editor-task21', taskId: 'mail.task21Response' },
    { id: 'editor-task22', taskId: 'mail.replyDraft' }
  ];

  editorConfigs.forEach(config => {
    ClassicEditor
      .create(document.getElementById(config.id), {
        plugins: [
          Essentials, Paragraph, Bold, Italic, Underline, Link, List, 
          Image, ImageUpload, Base64UploadAdapter, Heading, BlockQuote, Table, MediaEmbed, Code, CodeBlock
        ],
        toolbar: [
          'heading', '|',
          'bold', 'italic', 'underline', '|',
          'link', 'bulletedList', 'numberedList', '|',
          'imageUpload', 'blockQuote', 'insertTable', 'codeBlock', '|',
          'undo', 'redo'
        ],
        heading: {
          options: [
            { model: 'paragraph', title: 'Paragraph', class: 'ck-heading_paragraph' },
            { model: 'heading1', view: 'h1', title: 'Heading 1', class: 'ck-heading_heading1' },
            { model: 'heading2', view: 'h2', title: 'Heading 2', class: 'ck-heading_heading2' },
            { model: 'heading3', view: 'h3', title: 'Heading 3', class: 'ck-heading_heading3' }
          ]
        },
        image: {
          toolbar: ['imageTextAlternative']
        },
        placeholder: config.id === 'editor-task21' 
          ? 'Write your professional email response here...' 
          : 'Write your analysis and reply here...'
      })
      .then(editor => {
        console.log('CKEditor initialized:', config.id);
        window[config.id] = editor;
      })
      .catch(error => {
        console.error('CKEditor initialization error for', config.id, error);
      });
  });
})();
</script>
<a href="/contact.html" class="help-fab" id="helpFab" title="Questions? Reach the on-call engineer.">
  <img src="/help-contact.svg" alt="Contact" width="38" height="38">
  <span class="help-label">Questions? Contact on-call.</span>
</a>
<script src="/simple-autosave.js" data-task-id="mail"></script>
<script>
// Progress tracking for Task 2
const savedQuestions = new Set();

function updateProgressBar() {
  const total = 2;
  const saved = savedQuestions.size;
  const percentage = (saved / total) * 100;
  
  document.getElementById('progressBar').style.width = percentage + '%';
  document.getElementById('progressText').textContent = saved + '/' + total + ' Questions Saved';
  
  // Update task progress when completed
  if (saved === total) {
    updateMainTaskProgress('mail', 100);
    markTaskComplete('task2');
  }
}

function updateMainTaskProgress(taskId, progressPercentage) {
  try {
    const taskProgress = JSON.parse(localStorage.getItem('taskProgress') || '{}');
    taskProgress[taskId] = progressPercentage;
    localStorage.setItem('taskProgress', JSON.stringify(taskProgress));
    console.log('Task progress updated:', taskId, progressPercentage + '%');
  } catch (e) {
    console.error('Error updating task progress:', e);
  }
}

function markTaskComplete(taskId) {
  try {
    let completedTasks = JSON.parse(localStorage.getItem('examTasksCompleted') || '[]');
    if (!completedTasks.includes(taskId)) {
      completedTasks.push(taskId);
      localStorage.setItem('examTasksCompleted', JSON.stringify(completedTasks));
      console.log('Task marked complete:', taskId);
      window.dispatchEvent(new StorageEvent('storage', {
        key: 'examTasksCompleted',
        newValue: JSON.stringify(completedTasks)
      }));
    }
  } catch (e) {
    console.error('Error marking task complete:', e);
  }
}

// Save Task 2 progress function
function saveTask2Progress(question) {
  const messageDiv = document.getElementById('progressMessage' + (question === 'q3' ? 'Q3' : 'Q4'));
  const btn = document.getElementById('save' + (question === 'q3' ? 'Q3' : 'Q4') + 'Btn');
  
  // Add question to saved set
  savedQuestions.add(question);
  updateProgressBar();
  
  // Show success message
  messageDiv.textContent = '‚úì Progress saved!';
  messageDiv.style.color = '#059669';
  
  // Brief button feedback
  const originalText = btn.textContent;
  btn.textContent = '‚úì Saved!';
  btn.style.background = 'linear-gradient(135deg, #34d399 0%, #10b981 100%)';
  
  setTimeout(() => {
    messageDiv.textContent = '';
    btn.textContent = originalText;
    btn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
  }, 3000);
}

// Load saved progress from localStorage
const storedProgress = localStorage.getItem('task2Progress');
if (storedProgress) {
  try {
    const progress = JSON.parse(storedProgress);
    progress.forEach(q => savedQuestions.add(q));
    updateProgressBar();
  } catch (e) {
    console.error('Error loading progress:', e);
  }
}

// Save progress to localStorage on change
window.addEventListener('beforeunload', function() {
  localStorage.setItem('task2Progress', JSON.stringify([...savedQuestions]));
});
</script>
</body>
</html>